<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/media.css">

</head>




<div class="body">


    <div class="app">

        <div class="cardList">
            <button class="cardList__btn btn btn--left">
                <div class="icon">
                    <svg>
                        <use xlink:href="#arrow-left"></use>
                    </svg>
                </div>

            </button>

            <div class="cards__wrapper">
                <div id="firstcard" class="card  current--card">
                    <div class="card__image">
                        <img class="banka1" src="img/banka1.webp" alt="" />

                    </div>
                </div>

                <div id="secondcard" class="card  next--card">
                    <div class="card__image">
                        <img class="banka2" src="img/banka2.webp" alt="" />

                    </div>
                </div>

                <div id="thirdcard" class="card  previous--card">
                    <div class="card__image">
                        <img class="banka3" src="img/banka3.webp" alt="" />
                    </div>
                </div>
            </div>


            <button class="cardList__btn btn btn--right">
                <div class="icon">
                    <svg>
                        <use xlink:href="#arrow-right"></use>
                    </svg>
                </div>
            </button>
            <div class="infoList">
                <div class="info__wrapper">
                    <div class="info info1 current--info">
                        <h1 class=" name">Monashka</h1>
                        <h1 class=" location1 location nobg">Уникальные вкусы в классической, Ultra, Frost и Bubbles
                            линейках.
                            Жидкость, которая покорила сердца стильным дизайном, сочным вкусом и необычным
                            персонажем. Монашка ждёт, когда ты с ней познакомишься. Выбери то, что подойдет
                            именно тебе и скорее назначай свидание.
                        </h1>
                        <div class="description1"><a target="_blank"
                                href="https://sniiinp.ru/wp-content/themes/blank-wordpress-theme-master/monashka.html">посмотреть</a>
                        </div>
                    </div>

                    <div class="info info2 next--info">
                        <h1 class=" name">Gorilla</h1>
                        <h4 class="location2 location nobg">Мощная, драйвовая жидкость для любителей экстрима. Линейка,
                            которую производят за границей. Привозим исключительно для наших клиентов. Сочный
                            вкус лета и бодрость в каждой затяжке. Какая комбинация станет фаворитом? Решать
                            тебе!</h4>
                        <div class="description2"><a target="_blank"
                                href="https://sniiinp.ru/wp-content/themes/blank-wordpress-theme-master/gorilla.html">посмотреть</a>
                        </div>

                        <!-- <div class="description2"><a href="google.com">посмотреть</a></div> -->
                    </div>

                    <div class="info info3 previous--info">
                        <h1 class=" name">Masons</h1>
                        <h4 class="location3 location nobg">Загадочный дизайн и вкус для ценителей. Первая в мире
                            жидкость на
                            основе векторного никотина. Особенная технология изготовления, благодаря которому
                            вкус получается мягким и нежным, без привкусов. Какие загадки масонов на вкус?
                            Попробуй и сохрани это в тайне.</h4>
                        <div class="description3"><a target="_blank"
                                href="https://sniiinp.ru/wp-content/themes/blank-wordpress-theme-master/mason.html">посмотреть</a>
                        </div>

                    </div>
                </div>
            </div>
        </div>




        <div class="app__bg">
            <div class="app__bg__image current--image">
                <img src="img/jijabg1.webp" alt="" />
                <img class="bankabg1" src="img/firstbg.webp" alt="" />
            </div>
            <div class="app__bg__image next--image">
                <img src="img/jijabg2.webp" alt="" />
                <img class="bankabg3" src="img/secondbg.webp" alt="" />
            </div>
            <div class="app__bg__image previous--image">
                <img src="img/jijabg3.webp" alt="" />
                <img class="bankabg2" src="img/thirdbg.webp" alt="" />
            </div>
        </div>
    </div>

    <div class="loading__wrapper">
        <div class="loader--text">Loading...</div>
        <div class="loader">
            <span></span>
        </div>
    </div>


    <svg class="icons" style="display: none;">
        <symbol id="arrow-left" xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'>
            <polyline points='328 112 184 256 328 400'
                style='fill:none;stroke:#fff;stroke-linecap:round;stroke-linejoin:round;stroke-width:48px' />
        </symbol>
        <symbol id="arrow-right" xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'>
            <polyline points='184 112 328 256 184 400'
                style='fill:none;stroke:#fff;stroke-linecap:round;stroke-linejoin:round;stroke-width:48px' />
        </symbol>
    </svg>


</div>

<script src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.3.3/gsap.min.js"></script>

<script>

    console.clear();

    const { gsap, imagesLoaded } = window;

    const buttons = {
        prev: document.querySelector(".btn--left"),
        next: document.querySelector(".btn--right"),
    };
    const cardsContainerEl = document.querySelector(".cards__wrapper");
    const appBgContainerEl = document.querySelector(".app__bg");

    const cardInfosContainerEl = document.querySelector(".info__wrapper");

    buttons.next.addEventListener("click", () => swapCards("right"));

    buttons.prev.addEventListener("click", () => swapCards("left"));

    function swapCards(direction) {
        const currentCardEl = cardsContainerEl.querySelector(".current--card");
        const previousCardEl = cardsContainerEl.querySelector(".previous--card");
        const nextCardEl = cardsContainerEl.querySelector(".next--card");

        const currentBgImageEl = appBgContainerEl.querySelector(".current--image");
        const previousBgImageEl = appBgContainerEl.querySelector(".previous--image");
        const nextBgImageEl = appBgContainerEl.querySelector(".next--image");

        changeInfo(direction);
        swapCardsClass();

        removeCardEvents(currentCardEl);

        function swapCardsClass() {
            currentCardEl.classList.remove("current--card");
            previousCardEl.classList.remove("previous--card");
            nextCardEl.classList.remove("next--card");

            currentBgImageEl.classList.remove("current--image");
            previousBgImageEl.classList.remove("previous--image");
            nextBgImageEl.classList.remove("next--image");

            currentCardEl.style.zIndex = "50";
            currentBgImageEl.style.zIndex = "-2";

            if (direction === "right") {
                previousCardEl.style.zIndex = "20";
                nextCardEl.style.zIndex = "30";

                nextBgImageEl.style.zIndex = "-1";

                currentCardEl.classList.add("previous--card");
                previousCardEl.classList.add("next--card");
                nextCardEl.classList.add("current--card");

                currentBgImageEl.classList.add("previous--image");
                previousBgImageEl.classList.add("next--image");
                nextBgImageEl.classList.add("current--image");
            } else if (direction === "left") {
                previousCardEl.style.zIndex = "30";
                nextCardEl.style.zIndex = "20";

                previousBgImageEl.style.zIndex = "-1";

                currentCardEl.classList.add("next--card");
                previousCardEl.classList.add("current--card");
                nextCardEl.classList.add("previous--card");

                currentBgImageEl.classList.add("next--image");
                previousBgImageEl.classList.add("current--image");
                nextBgImageEl.classList.add("previous--image");
            }
        }
    }

    function changeInfo(direction) {
        let currentInfoEl = cardInfosContainerEl.querySelector(".current--info");
        let previousInfoEl = cardInfosContainerEl.querySelector(".previous--info");
        let nextInfoEl = cardInfosContainerEl.querySelector(".next--info");

        gsap.timeline()
            .to([buttons.prev, buttons.next], {
                duration: 0.2,
                opacity: 0.5,
                pointerEvents: "none",
            })
            .to(
                currentInfoEl.querySelectorAll(".text"),
                {
                    duration: 0.4,
                    stagger: 0.1,
                    translateY: "-120px",
                    opacity: 0,
                },
                "-="
            )
            .call(() => {
                swapInfosClass(direction);
            })
            .call(() => initCardEvents())
            .fromTo(
                direction === "right"
                    ? nextInfoEl.querySelectorAll(".text")
                    : previousInfoEl.querySelectorAll(".text"),
                {
                    opacity: 0,
                    translateY: "40px",
                },
                {
                    duration: 0.4,
                    stagger: 0.1,
                    translateY: "0px",
                    opacity: 1,
                }
            )
            .to([buttons.prev, buttons.next], {
                duration: 0.2,
                opacity: 1,
                pointerEvents: "all",
            });

        function swapInfosClass() {
            currentInfoEl.classList.remove("current--info");
            previousInfoEl.classList.remove("previous--info");
            nextInfoEl.classList.remove("next--info");

            if (direction === "right") {
                currentInfoEl.classList.add("previous--info");
                nextInfoEl.classList.add("current--info");
                previousInfoEl.classList.add("next--info");
            } else if (direction === "left") {
                currentInfoEl.classList.add("next--info");
                nextInfoEl.classList.add("previous--info");
                previousInfoEl.classList.add("current--info");
            }
        }
    }

    function updateCard(e) {
        const card = e.currentTarget;
        const box = card.getBoundingClientRect();
        const centerPosition = {
            x: box.left + box.width / 2,
            y: box.top + box.height / 2,
        };
        let angle = Math.atan2(e.pageX - centerPosition.x, 0) * (35 / Math.PI);
        gsap.set(card, {
            "--current-card-rotation-offset": `${angle}deg`,
        });
        const currentInfoEl = cardInfosContainerEl.querySelector(".current--info");
        gsap.set(currentInfoEl, {
            rotateY: `${angle}deg`,
        });
    }

    function resetCardTransforms(e) {
        const card = e.currentTarget;
        const currentInfoEl = cardInfosContainerEl.querySelector(".current--info");
        gsap.set(card, {
            "--current-card-rotation-offset": 0,
        });
        gsap.set(currentInfoEl, {
            rotateY: 0,
        });
    }

    function initCardEvents() {
        const currentCardEl = cardsContainerEl.querySelector(".current--card");
        currentCardEl.addEventListener("pointermove", updateCard);
        currentCardEl.addEventListener("pointerout", (e) => {
            resetCardTransforms(e);
        });
    }

    initCardEvents();

    function removeCardEvents(card) {
        card.removeEventListener("pointermove", updateCard);
    }

    function init() {

        let tl = gsap.timeline();

        tl.to(cardsContainerEl.children, {
            delay: 0.15,
            duration: 0.5,
            stagger: {
                ease: "power4.inOut",
                from: "right",
                amount: 0.1,
            },
            "--card-translateY-offset": "0%",
        })
            .to(cardInfosContainerEl.querySelector(".current--info").querySelectorAll(".text"), {
                delay: 0.5,
                duration: 0.4,
                stagger: 0.1,
                opacity: 1,
                translateY: 0,
            })
            .to(
                [buttons.prev, buttons.next],
                {
                    duration: 0.4,
                    opacity: 1,
                    pointerEvents: "all",
                },
                "-=0.4"
            );
    }

    const waitForImages = () => {
        const images = [...document.querySelectorAll("img")];
        const totalImages = images.length;
        let loadedImages = 0;
        const loaderEl = document.querySelector(".loader span");

        gsap.set(cardsContainerEl.children, {
            "--card-translateY-offset": "100vh",
        });
        gsap.set(cardInfosContainerEl.querySelector(".current--info").querySelectorAll(".text"), {
            translateY: "40px",
            opacity: 0,
        });
        gsap.set([buttons.prev, buttons.next], {
            pointerEvents: "none",
            opacity: "0",
        });

        images.forEach((image) => {
            imagesLoaded(image, (instance) => {
                if (instance.isComplete) {
                    loadedImages++;
                    let loadProgress = loadedImages / totalImages;

                    gsap.to(loaderEl, {
                        duration: 1,
                        scaleX: loadProgress,
                        backgroundColor: `hsl(${loadProgress * 120}, 100%, 50%`,
                    });

                    if (totalImages == loadedImages) {
                        gsap.timeline()
                            .to(".loading__wrapper", {
                                duration: 0.8,
                                opacity: 0,
                                pointerEvents: "none",
                            })
                            .call(() => init());
                    }
                }
            });
        });
    };

    waitForImages();







</script>
<script>
    document.querySelector("#start").onclick = function () {

        window.open('http://vk.com/', '_blank');


    }
</script>

</html>